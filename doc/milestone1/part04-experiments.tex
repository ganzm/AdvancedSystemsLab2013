\documentclass[milestone1.tex]{subfiles} 
\begin{document}

%% ----------------------------------------------
% Section Experiments
%% ----------------------------------------------
\section{Experiments}

\subsection{Testload}
TODO
\subsubsection{OneWayClient}
TODO
\subsubsection{PairedClient}
TODO
\subsubsection{PublicQueueConsumer}
TODO
\subsubsection{PublicQueueProducer}
TODO
\subsection{2 hour test}


% for each experiment
%- why are we doing this experiment
%- hypothesis
%- experiment setup (parameters)
%- plots of the result
%- describe the plot
%- explain the plot/experiment

To verify that the system runs stable over a long period of time an experiment is performed which puts a constant load onto the system for 2 hours.

\paragraph{Experiment setup}
The experiment is performed on the Amazone cloud with a certain number of clients constantly sending messages and some consuming messages. 

\begin{tabular}{|l|c|}
\hline 
Parameter & Value \\
\hline 
Where to run & Amazone Cloud \\ 
Amazone instance type for the database & TODO \\ 
Amazone instance type for the middle(s) ware& TODO \\ 
Amazone instance type for the clients & TODO \\ 
Number of middle wares & 1 \\ 
Number of sending clients & 4 (2 per machine) \\ 
Number of sending clients & 4 (2 per machine) \\ 
Client message send interval & 100ms \\
\hline 
\end{tabular}

\paragraph{Hypothesis}
Since the system will not be saturated we expect no changes over time concerning response time and throughput. There will be sent and received 40 messages per second which should be easy to handle by a single middle ware instance.

\paragraph{Results}

TODO

See Testrun 11

% https://testmaster-asl-eth.renuo.ch/test_runs/11

\paragraph{Interpretation}

TODO
%% -------------------------------------------
%% 2^k Experiment
%% -------------------------------------------
\subsection{$2^k$ Experiment}
In order to determine the influence of a number of primary factors on to the system it was decided to do a $2^k$ analysis on several factors described in the following section.

For each feature level an experiment of 30 minutes is performed where clients perform 100 actions (send, receive message) per second.

\subsubsection{Factors and Levels}

\paragraph{Number of Clients}
The number of simultaneously connected clients is varied between 8 and 30. There is a mix of different clients which produce slightly different types of load.

\begin{tabular}{|l|c|c|}
\hline 
 & Lower Level & Upper Level \\ 
\hline 
OneWayClient & 16 & 8  \\ 
\hline 
PairedClient & 8 & 4 \\ 
\hline 
PublicQueueConsumer & 4 & 2 \\ 
\hline 
PublicQueueProducer & 2 & 1 \\ 
\hline 
\textbf{Total}  & \textbf{30} & \textbf{15} \\
\hline 
\end{tabular} 

\paragraph{Number of brokers}

The number of middleware components is varied between 4 and 8. For both levels the number of Amazone instances used is 2.

\paragraph{Number of workers}

The number of worker threads running on a single middle ware component is varied between 4 and 8

\paragraph{Number of Db Connections}

The number of db connection a single middleware concurrently has is varied between 4 and 8

\subsubsection{Measurement Results}

There are two different versions of the test runs considering the dequeueMessage interface. The V1 will always return a message if there is a message in the queue. V2 should return a message if there is a message in the queue, but if two clients dequeue a message at the same time, one will receive the message while the other client will not get a message.\\

\textbf{Hypothesis}\\

V1 has to lock single rows, while V2 doesn\'t have to lock them. Thus, V2 should be faster. The process time is the (mean/percentile(0.25)/percentile(97.5)/stddev) of the messages of message type "BTotReqResp".\\

\begin{tabular}{cccccccc}
\rot{Clients} & \rot{Brokers} & \rot{Workers} & \rot{Connections} & \rot{V1 TestRun Id} & \rot{V1 Process time} & \rot{V2 TestRun Id} & \rot{V2 Process time} \\
\hline 
15 & 4 & 4 & 4 & 151 & w/x/y/z & 128 & w/x/y/z \\ 
\hline 
15 & 4 & 4 & 8 & 152 & • & 129 & • \\ 
\hline 
15 & 4 & 8 & 4 & 153 & • & 130 & • \\ 
\hline 
15 & 4 & 8 & 8 & 154 & • & 131 & • \\ 
\hline 
15 & 8 & 4 & 4 & 155 & • & 132 & • \\ 
\hline 
15 & 8 & 4 & 8 & 156 & • & 133 & • \\ 
\hline 
15 & 8 & 8 & 4 & 157 & • & 134 & • \\ 
\hline 
15 & 8 & 8 & 8 & 158 & • & 135 & • \\ 
\hline 
30 & 4 & 4 & 4 & 159 & • & 136 & • \\ 
\hline 
30 & 4 & 4 & 8 & 160 & • & 137 & • \\ 
\hline 
30 & 4 & 8 & 4 & 161 & • & 138 & • \\ 
\hline 
30 & 4 & 8 & 8 & 162 & • & 139 & • \\ 
\hline 
30 & 8 & 4 & 4 & 163 & • & 140 & • \\ 
\hline 
30 & 8 & 4 & 8 & 164 & • & 141 & • \\ 
\hline 
30 & 8 & 8 & 4 & 165 & • & 142 & • \\ 
\hline 
30 & 8 & 8 & 8 & 166 & • & 143 & • \\ 
\hline 

\end{tabular} 


%% -------------------------------------------
\subsection{Db load test}

testrun 87 shows what happens when we add more messages than we delete. 

After 2h the database contains 170000 messages
show plots for query peek time, etc
db access gets slower

\subsection{divers}

testrun 105 - out of disk space

\end{document}